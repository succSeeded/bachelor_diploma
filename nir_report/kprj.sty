% !TeX encoding = UTF-8
%%%    Стилевой файл для оформления курсовых и лабораторных работ
%%%
%%%    Автор А.Н. Канатников
%%%    Версия от от 03.10.2018
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{kprj}[2018/10/03 -- report style for course and laboratory works, A.N. Kanatnikov]


\def\ifempty#1{\def\@tempa{#1}\ifx\@tempa\@empty}
\newif\ifpdftex
\@ifundefined{pdfoutput}{\pdftexfalse}{\ifnum1=\pdfoutput\pdftextrue\else\pdftexfalse\fi}


%% Параметры страницы

%\textwidth=160mm
%\textheight=240mm
%\oddsidemargin=30mm
%\marginparwidth=0mm
%\marginparsep=10mm
%\AtBeginDocument{\advance\hoffset by -1in\advance\voffset by -1in}
\parindent=12.5mm
\righthyphenmin=2

%\ProcessOptions

\RequirePackage{setspace} 
\RequirePackage{amssymb}
\RequirePackage{amsmath}
\RequirePackage{amsthm}
\RequirePackage{cite}
\ifpdftex\RequirePackage{cmap}\fi
\RequirePackage{graphicx}

\let\contsectionfont\relax
\let\contsubsectionfont\relax
\let\No\textnumero
\def\sectionfont{\large\bf}
\def\subsectionfont{\bf}
\def\subsubsectionfont{\it}
\def\captionfont{\small}
\def\captionnofont{\bfseries}
\def\foliofont{\rm}
\def\colonfont{\footnotesize\sl}
\def\@underwr@font{\fontsize{8pt}{8}\selectfont}
\DeclareMathSizes{11}{11}{8}{6}

\def\l@secsepbefore{3mm}
\def\l@subsecsepbefore{1mm}
\def\l@subsubsecsepbefore{1mm}
\def\secsepbefore{3.5ex plus 1ex minus .2ex}
\def\secsepafter{3.5ex plus.2ex}
\def\subsecsepbefore{2ex plus 1ex minus .2ex}
\def\subsecsepafter{2ex plus 0.3ex minus 0.2ex}
\def\subsubsecsepbefore{3ex plus 1ex minus .2ex}
\def\subsubsecsepafter{2ex plus 0.3ex minus 0.2ex}

\renewcommand\thesubfigure{}
\newcommand{\reffig}[1]{рис. \oldref{#1}}

\theoremstyle{definition}
\newtheorem{theorem}{Теорема}
\theoremstyle{definition}
\newtheorem{definition}{Определение}
\theoremstyle{definition}
\newtheorem{affirmation}{Утверждение}
\theoremstyle{definition}
\newtheorem{example}{Пример}
\renewenvironment{proof}{\noindent$\blacktriangleleft$}{}
\renewcommand\qedsymbol{$\blacktriangleright$}

\renewcommand{\ge}{\geqslant}
\renewcommand{\le}{\leqslant}

\addto\captionsrussian{\def\contentsname{Содержание}}
\addto\captionsrussian{\def\refname{Список использованных источников}}

\AtEndOfPackage{\pagestyle{oneside}}

\def\@grpl@len{5em}
\def\@subspl@len{10em}
\def\@FIOpl@len{8em}
\def\@stampleftwidth{80mm}

\input{t2acmtt.fd}
\input{umsa.fd}
\input{umsb.fd}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%     Секционирование
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5

\def\@startctsection#1#2#3#4#5#6{\if@noskipsec \leavevmode \fi
	\par \@tempskipa #4\relax
	\@afterindenttrue
	\ifdim \@tempskipa <\z@ \@tempskipa -\@tempskipa \@afterindentfalse\fi
	\if@nobreak \everypar{}\else
	\addpenalty{\@secpenalty}\addvspace{\@tempskipa}\fi
	\@ifnextchar-{\secno@false\@@startctsection{#1}{#2}{#3}{#4}{#5}{#6}}%
	{\secno@true\@@startctsection{#1}{#2}{#3}{#4}{#5}{#6}-}}
\def\@@startctsection#1#2#3#4#5#6-{%
	\@ifstar
	{\@sctsect{#3}{#4}{#5}{#6}}
	{\@threarg{\@ctsect{#1}{#2}{#3}{#4}{#5}{#6}}}}
\long\def\@threarg#1{\@ifnextchar [{\@nthrearg{#1}}{\@xthrearg{#1}}}
\long\def\@xthrearg#1#2{#1[{#2}][{#2}]{#2}}
\long\def\@nthrearg#1[#2]{\@ifnextchar [{#1[#2]}{#1[#2][#2]}}

\def\@ctsect#1#2#3#4#5#6[#7][#8]#9{%
	\ifnum #2>\c@secnumdepth\secno@false\fi
	\ifsecno@
	\refscstepcounter{#1}\def\@svsec{\@makectsecthead{#1}\hskip#3\relax}%
	\def\cont@svsec{\protect\numberline{\@makecontctsecthead{#1}\space}}%
	\else
	\let\@svsec\@empty\let\cont@svsec\@empty
	\fi
	\ifdefined\href
	\Hy@GlobalStepCount\Hy@linkcounter                                         % И.К.
	\xdef\@currentHref{section*.\the\Hy@linkcounter}%                          % И.К.
	\Hy@raisedlink{\hyper@anchorstart{\@currentHref}\hyper@anchorend}%         % И.К.
	\fi
	\@tempskipa#5\relax
	\ifdim\@tempskipa>\z@
	\begingroup
	#6\relax
	\raggedcenter@\interlinepenalty\@M #6\relax\@svsec\ifnum #2<2\MakeUppercase{#9}\else #9\fi\par
	\endgroup
	\csname #1mark\endcsname{#8}
	\addcontentsline{toc}{#1}{\cont@svsec\ifnum #2<2\MakeUppercase{#7}\else #7\fi}%
	\else
	\def\@svsechd{%
		#6\@svsec#9\@nameuse{#1mark}{#8}%
		\addcontentsline{toc}{#1}{\cont@svsec#7}}%
	\fi
	\@xsect{#5}}

\def\@xsect#1{\@tempskipa #1\relax
	\ifdim \@tempskipa>\z@
	\par \nobreak
	\vskip \@tempskipa
	\@afterheading
	\else \global\@nobreakfalse \global\@noskipsectrue
	\everypar{\if@noskipsec \global\@noskipsecfalse
		\clubpenalty\@M \hskip -\parindent
		\begingroup \@svsechd. \endgroup \unskip
		\hskip -#1\relax  % relax added 14 Jan 91
		\else \clubpenalty \@clubpenalty
		\everypar{}\fi}\fi\ignorespaces}

\def\@sctsect#1#2#3#4#5{\@tempskipa #3\relax
	\ifdim \@tempskipa>\z@
	\begingroup
	\interlinepenalty\@M \raggedcenter@ #4\hskip #1\relax \MakeUppercase{#5}\par     %%%    --- И.К. 29.09.2009
	\endgroup
	\else
	\begingroup
	\def\@svsechd{\raggedcenter@ #4\hskip #1\relax #5}            %%%    --- И.К. 29.09.2009
	\endgroup
	\fi
	\@xsect{#3}}

\def\@makectsecthead#1{\@nameuse{head#1}\@nameuse{the#1}\hspace{0.32em}}
\def\@makecontctsecthead#1{\hbox to 0pt{\hss \hspace{0pt}}\@nameuse{the#1}}% черт знает почему, но hspace{0pt} вместо @nameuse{conthd#1} фиксит проблему с toc-файлом -- 3.05.2024
\def\section@dot{}
\newif\ifsecno@
\def\secdelim#1{\def\@secdelimamount{#1}\gdef\@secdelim{\@secdelimamount}}
\gdef\appendixname{ПРИЛОЖЕНИЕ}
\gdef\conthdsection{}
\secdelim{0.1em}


\def\section{\newpage\@startctsection{section}{1}{\@secdelim}%
	{\secsepbefore}{\secsepafter}{\reset@font\sectionfont}}
\def\subsection{\@startctsection{subsection}{2}{\@secdelim}%
	{\subsecsepbefore}{\subsecsepafter}{\reset@font\subsectionfont}}
\def\subsubsection{\@startctsection{subsubsection}{3}{\@secdelim}%
	{\subsubsecsepbefore}{\subsubsecsepafter}{\reset@font\subsubsectionfont}}
\newenvironment{annotation}{\section*{Реферат}}{\pagebreak}
\newenvironment{introduction}{\section*{Введение}\addcontentsline{toc}{section}{\MakeUppercase{Введение}}}{\pagebreak}
\newenvironment{conclusion}{\section*{Заключение}\addcontentsline{toc}{section}{\MakeUppercase{Заключение}}}{\pagebreak}

%%%    Оформление содержания

\def\tableofcontents{\section*{\contentsname
		\@mkboth{\MakeUppercase{\contentsname}}{\MakeUppercase{\contentsname}}}%
	\@starttoc{toc}%
	\if@contentsbreak\clearpage\fi}

\newif\if@contentsbreak\@contentsbreaktrue
\let\InsertContentsbreak\@contentsbreaktrue
\let\SkipContentsbreak\@contentsbreakfalse
\def\l@section#1{\addvspace\l@secsepbefore\@dottedtocline{1}{0em}{1.6em}{\contsectionfont#1}}
\def\l@subsection#1{\addvspace\l@subsecsepbefore\@dottedtocline{2}{1.6em}{2.2em}{\contsubsectionfont#1}}
\def\l@subsubsection{\addvspace\l@subsubsecsepbefore\@dottedtocline{2}{3.8em}{2.8em}}



%%%        Оформление списка литературы и цитирования источников

\renewcommand{\@biblabel}[1]{#1.\hfill}
\renewenvironment{thebibliography}[1]
{\section-{\refname}%
	\@mkboth{\refname}{\refname}%
	\list{\@biblabel{\@arabic\c@enumiv}}%
	{\settowidth\labelwidth{\@biblabel{#1}}%
		\leftmargin\labelwidth
		\advance\leftmargin\labelsep
		\@openbib@code
		\usecounter{enumiv}%
		\let\p@enumiv\@empty
		\renewcommand\theenumiv{\@arabic\c@enumiv}}%
	\sloppy
	\clubpenalty4000
	\@clubpenalty \clubpenalty
	\widowpenalty4000%
	\sfcode`\.\@m}
{\def\@noitemerr
	{\@latex@warning{Empty `thebibliography' environment}}%
	\endlist}


%%%   Модификация параметров списков \@listi-\@listiii
%%%   добавлением в конец специальной команды \@userpar
\def\@change@itemlists{%
	\let\@tempa\@listi\edef\@listi{\@tempa\@vslisti\@userpar}%
	\let\@listI\@listi
	\let\@tempa\@listii\edef\@listii{\@tempa\@vslistii\@userpar}%
	\let\@tempa\@listiii\edef\@listiii{\@tempa\@vslistiii\@userpar}%
	\let\@tempa\@openbib@code\edef\@openbib@code{\@tempa\@userpar}%
	\let\@change@itemlists\relax}
\def\userpar#1{\@change@itemlists
	\def\@userpar{#1\global\let\@userpar\relax}\ignorespaces}
\let\@userpar\relax
\def\@vslisti{\topsep=0.2ex plus 0.2ex minus 0.2ex
	\partopsep=0.4ex plus 0.2ex minus 0.2ex
	\parsep=0pt plus 0.2ex\itemsep=\parsep}
\let\@vslistii\@vslisti
\let\@vslistiii\@vslisti


%%  Команда организации многострочных заголовков
\def\raggedcenter@{\leftskip\z@ plus.4\hsize \rightskip\leftskip
	\parfillskip\z@ \parindent\z@ \spaceskip.5em \xspaceskip.7em\relax
	\pretolerance9999\tolerance9999 \exhyphenpenalty\@M\relax
	\hyphenpenalty\@M \let\\\linebreak}
\def\raggedright@{\leftskip\z@\rightskip\z@ plus.4\hsize
	\parindent\z@ \spaceskip.5em \xspaceskip.7em\relax
	\pretolerance9999\tolerance9999 \exhyphenpenalty\@M\relax
	\hyphenpenalty\@M \let\\\newline}
\def\refscstepcounter#1{\stepcounter{#1}\let\@tempa\protect
	\def\protect{\noexpand\protect\noexpand}%
	\edef\@currentlabel{\csname p@#1\endcsname\csname conthd#1\endcsname\csname the#1\endcsname}%
	\let\protect\@tempa}


%%% Колонтитулы

%\def\ps@oneside{%
%	\let\@mkboth\markboth
%	\def\@oddfoot{}\def\@evenfoot{}%
%	\@twosidefalse\@mparswitchfalse\reversemarginpar
%	\def\chapterpagestyle{plain}%
%	\def\@oddhead{%
%		\vbox to \headheight{%
%			\hbox to \textwidth{{\colonfont\leftmark}\hfil{\foliofont\thepage}}%
%			\kern2pt\hrule\vss}}%
%	\let\@evenhead\@oddhead  %   На всякий случай
%	\def\sectionmark##1{\markboth{{\ifnum \c@secnumdepth >\z@
%				\conthdsection\thesection.\ \fi ##1}}{}}}
\def\ps@oneside{%
	\let\@mkboth\markboth
	\def\@oddfoot{%
		\vbox to \headheight{%
			\hbox to \textwidth{\hfil{\foliofont\thepage}\hfil}}}%
		\def\@evenfoot{}%
	\@twosidefalse\@mparswitchfalse\reversemarginpar
	\def\chapterpagestyle{plain}%
	\def\@oddhead{}%
	\def\@evenhead{}%
	\let\@evenfoot\@oddfoot  %   На всякий случай
	\def\sectionmark##1{\markboth{{\ifnum \c@secnumdepth >\z@
				\conthdsection\thesection.\ \fi ##1}}{}}}

%%%   Нумерация формул, ри сунков и проч.

\def\thesection{\arabic{section}}
\def\@section@name{section}
\def\@whole@name{whole}
\newcommand\@obj@numbering[2]{\def\@tempa{#2}%
	\ifx\@tempa\@section@name
	\@namedef{the#1}{\thesection.\arabic{#1}}%    +7 926 282 8577
	\@addtoreset{#1}{section}%
	\fi}
\newcommand\equationnumbering{\@obj@numbering{equation}}
\let\eqnumb\equationnumbering
\newcommand\figurenumbering{\@obj@numbering{figure}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%   Титульный лист и спец листы (задание, кал. план)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\ulbox#1#2{\underline{\hbox to #1{#2\hfil}}}
\def\ulfill{\leaders\hrule height-1pt depth1.4pt\hfill\kern\z@}
\def\UlBox#1#2{\hbox to 0pt{#2\hss}\nobreak\vrule height-1pt depth1.4pt width#1{}}
\def\ulline{\vspace{12pt}\hrulefill}
\newdimen\jsp\jsp=0.9mm

\def\@labrab@title{{\bf ОТЧЕТ}\\ по лабораторной работе
	\ifnum\@title@no<1\else\space\No\@title@no\fi}
\def\@pract@title{\textbf{ОТЧЕТ}\\ по производственной практике}
\def\@rpzname{\MakeUppercase{Расчетно-пояснительная записка}}
\def\@kursproj@title{{\bfseries \@rpzname}\textit{\\к курсовому проекту\\на тему:}}
\def\@kursrab@title{{\bfseries \@rpzname}\textit{\\к курсовой работе\\на тему:}}
\def\@NIR@title{{\bfseries \@rpzname}\\к научно-исследовательской работе\\на тему:}
\def\@VKR@title{{\bfseries \@rpzname}\textit{\\к выпускной квалификационной работе\\на тему:}}
\def\@NKR@title{{\bfseries \@rpzname}\textit{\\к научной квалификационной работе\\на тему:}}
\def\@zadan@kurs@title{\vskip2mm{\rm по дисциплине\\%
		\@ifundefined{@discipline}{\ulbox{0.7\hsize}{}}{\al{}\@discipline\ar{}}}\par}
\def\@zadan@NIR@title{\vskip2mm{\rm по теме\\%
		\@ifundefined{@title}{\ulbox{0.7\hsize}{}}{\al{}\@title\ar{}}}\par}
\def\@zadan@kurs@theme{\vskip1mm
	Тема \@jobsp@type@rod:
	\ifx\@title\@empty\hrulefill\penalty-10000\hbox{}\hrulefill
	\else{\bfseries\@title}\fi\par}
\def\@zadan@VKR@theme{\vskip1mm Тема квалификационной работы:
	\ifx\@title\@empty\hrulefill\penalty-10000\hbox{}\hrulefill
	\else{\bfseries\@title}\fi\par}
\newif\if@jobspec\@jobspecfalse
\newif\if@inspector\@inspectorfalse
\newif\if@FirstConsultant\@FirstConsultantfalse
\newif\if@SecondConsultant\@SecondConsultantfalse
\newif\if@VKR\@VKRfalse
\newif\if@pract\@practfalse
\newif\if@pract@jobspec\@pract@jobspecfalse
\def\@chief@type{Руководитель \@jobsp@type@rod}
\def\@cons@type{Консультант}
\def\@make@zadanie{\gen@zadanie}
\def\KursProject{\let\@title@name\@kursproj@title\def\@titlename@font{}%
	\let\@zadan@title\@zadan@kurs@title\let\@zadan@theme\@zadan@kurs@theme
	\def\@jobsp@type@shrt{КП}\def\@chief@type{Руководитель \@jobsp@type@rod}%
	\@jobspectrue\def\@jobsp@type@rod{курсового проекта}%
	\@block@variant}%
\def\KursWork{\let\@title@name\@kursrab@title\def\@titlename@font{}%
	\let\@zadan@title\@zadan@kurs@title\let\@zadan@theme\@zadan@kurs@theme
	\def\@jobsp@type@shrt{КР}\def\@chief@type{Руководитель \@jobsp@type@rod}%
	\@jobspectrue\def\@jobsp@type@rod{курсовой работы}%
	\@block@variant}%
\def\NIR{\let\@title@name\@NIR@title\def\@titlename@font{}%
	\let\@zadan@title\@zadan@NIR@title\let\@zadan@theme\relax
	\def\@jobsp@type@shrt{НИР}\def\@chief@type{Руководитель \@jobsp@type@shrt}%
	\@jobspectrue\def\@jobsp@type@rod{научно-исследовательской работы}%
	\@block@variant}
\def\Pract{\@practtrue\let\@title@name\@pract@title\def\@titlename@font{\bf\itshape}%
	\@pract@jobspectrue%
	\def\@jobsp@type@shrt{практики}\def\@jobsp@type@rod{производственной практики}%
	\def\@chief@type{Руководитель \@jobsp@type@shrt}%
	\@block@variant}
\def\LabWork{\let\@title@name\@labrab@title\def\@titlename@font{\bf\itshape}
	\def\@chief@type{Руководитель}}
\def\VKR{\let\@title@name\@VKR@title\def\@titlename@font{}
	\def\@jobsp@type@shrt{ВКР}\let\@zadan@theme\@zadan@VKR@theme
	\let\@discipline\relax\def\discipline##1{}\let\@make@zadanie\@VKR@zadanie
	\@jobspectrue\@VKRtrue\def\@jobsp@type@rod{выпускной квалификационной работы}%
	\@FirstConsultanttrue\@SecondConsultanttrue\@inspectortrue\let\@zadan@title\relax\jsp=2mm
	\def\@chief@type{Руководитель \@jobsp@type@shrt}%
	\@block@variant}
\def\VKRTitleOnly{\let\@title@name\@VKR@title\def\@titlename@font{}
	\def\@jobsp@type@shrt{ВКР}\let\@zadan@theme\@zadan@VKR@theme
	\let\@discipline\relax\def\discipline##1{}
	\@FirstConsultanttrue\@SecondConsultanttrue\@inspectortrue
	\def\@chief@type{Руководитель \@jobsp@type@shrt}%
	\@block@variant}
\def\NKR{\VKR\let\@title@name\@NKR@title\def\@jobsp@type@shrt{НКР}%
	\def\@jobsp@type@rod{научной квалификационной работы}%
	\def\@chief@type{Научный руководитель}}
\def\LabWorkNo#1{\def\@title@no{#1}}
\def\PractType#1{\def\@practtype{#1}}
\def\PractFacility#1{\def\@facility{#1}}
\def\title#1{\def\@title{#1}}
\newcommand\authorfull[1]{\def\@authorfull{#1}}
\newcommand\workyear[1]{\def\@workyear{#1}}
\newcommand\discipline[1]{\def\@discipline{#1}}
\newcommand\authorcategory[1]{\def\@author@type{#1}}
\authorcategory{студент}
\newcommand\chair[1]{\def\@chair{#1}}
\newcommand\chairno[1]{\def\@chairno{#1}}
\let\chairshort\chairno
\newcommand\chairhead[1]{\def\@chairhead{#1}}
\newcommand\faculty[1]{\def\@faculty{#1}}
\newcommand\facultyshort[1]{\def\@faculty@short{#1}}
\newcommand\group[1]{\def\@group{#1}}
\newcommand\chief[1]{\def\@chief{#1}}
\newcommand\FirstConsultant[1]{\def\@FirstConsultant{#1}}
\newcommand\SecondConsultant[1]{\def\@SecondConsultant{#1}}
\newcommand\inspector[1]{\def\@inspector{#1}}
\newcommand\trend[1]{\def\@trend{#1}}
\newcommand\themesource[1]{\def\@themesource{#1}}
\def\variant#1{\def\@variant{#1}}
\def\@block@variant{\def\variant##1{}\let\@variant\relax}
\def\Ministry#1{\def\@Ministry{#1}}
\def\BMSTU#1{\def\@BMSTU{#1}}
\let\oldref=\ref 
\renewcommand{\ref}[1]{(\oldref{#1})}


%%  Настроечные команды

\title{}
\LabWorkNo{0}
\authorfull{}
\chair{}
\chairno{}
\chairhead{}
\group{}
\faculty{}
\facultyshort{}
\trend{}
\themesource{}
\Ministry{Министерство~науки~и~высшего~образования\\
	Российской~Федерации}
\BMSTU{Федеральное государственное бюджетное образовательное\\
	учреждение высшего образования\\
	\al{}Московский государственный технический университет\\
	имени Н.\,Э.~Баумана (национальный\\
	исследовательский университет)\ar{}\\
	(МГТУ им. Н.Э.~Баумана)}



\def\maketitle{%
	\begin{spacing}{1.0} % -- единичный межстрочный интвервал чтобы не слетало форматирование
		\thispagestyle{empty}
		\bgroup
		\centering
		\@title@shapka{emblema}%
		\ifx\@faculty\@empty\else\vskip4mm{\fontsize{14pt}{18pt}\selectfont\rm Факультет \textit{\al{}\@faculty\ar{}}\par}\fi
		\ifx\@chair\@empty\else\vskip4mm{\fontsize{14pt}{18pt}\selectfont Кафедра \textit{\al{}\@chair\ar{}}\par}\fi
		\vskip16mm
		\bgroup
		{\fontsize{16pt}{24pt}\selectfont
		\bgroup\@titlename@font\@title@name\par\egroup}
		\ifx\@title\@empty\else\vskip4mm{\fontsize{16pt}{24}\selectfont \textbf{\textit{\MakeUppercase{\@title}}}\par}\fi
		\@ifundefined{@discipline}{}{\vskip4mm{\rm по дисциплине\\[1mm] \al{}\@discipline\ar{}\par}}
		\@ifundefined{@variant}{}{\vskip4mm{\bfseries Вариант \No\@variant\par}}
		\egroup
		\vskip20mm
		{\fontsize{12pt}{12pt}\selectfont
		\bgroup
		\if@pract
		\@subscr@line@forpract{Студент}{\@ifundefined{@authorfull}{}{\@authorfull}}%
		\vskip5mm
		\@subscr@line@forpract{Группа}{\@ifundefined{@group}{}{\@group}}%
		\vskip5mm
		\@subscr@line@forpract{Тип практики}{\@ifundefined{@practtype}{}{\@practtype}}%
		\vskip5mm
		\@subscr@line@forpract{Название предприятия}{\@ifundefined{@facility}{}{\@facility}}%
		\fi
		\vfil
		\raggedright@
		\if@pract
		\@subscr@line{Студент}{}{\@ifundefined{@author}{\ulbox{7em}{}}{\@author}}%
		\else
		\@subscr@line{Студент группы}{\@group@place}{\@author}%
		\fi
		\@ifundefined{@chief}{}{\vskip5mm\@subscr@line{\@chief@type}{}{\@chief}}%
		\if@FirstConsultant
		\vskip5mm
		\@subscr@line{Консультант}{}{\@ifundefined{@FirstConsultant}{\ulbox{7em}{}}{\@FirstConsultant}}%
		\fi
		\if@SecondConsultant
		\vskip5mm
		\@subscr@line{Консультант}{}{\@ifundefined{@SecondConsultant}{\ulbox{7em}{}}{\@SecondConsultant}}%
		\fi
		\if@inspector
		\vskip5mm
		\@subscr@line{Нормоконтролер}{}{\@ifundefined{@inspector}{\ulbox{7em}{}}{\@inspector}}\par
		\fi
		\vskip20mm
		\if@pract{Оценка\hspace{0.6\linewidth}{\ulbox{0.3\linewidth}{}}\par}\fi
		\egroup
		\vfil
		\textit{\@workyear г.}\par
		\pagebreak
		\egroup
		\if@jobspec{\pagestyle{empty}\headheight=0pt\headsep=0pt\@make@jobspec\pagebreak}\fi
		\if@pract@jobspec{\@make@pract@jobspec\pagebreak}\fi
		\if@VKR\kalplan\fi}
	\end{spacing}
}
\let\cover\maketitle

\def\@title@shapka#1{%
	\bgroup
	\ifpdftex\def\emb@file{#1.pdf}\else\def\emb@file{#1.eps}\fi
	\hrule height0pt\vskip-\headheight\vskip-\headsep
	\ifempty{#1}\else
	\advance\leftskip by 40mm\noindent
	\dfb{\kern-3mm\hbox{\includegraphics[scale=0.19]{\emb@file}}}%
	\fi
	{\fontsize{12}{12pt}\selectfont\bfseries\@Ministry\par}%
	\vskip2mm
	{\fontsize{12}{12pt}\selectfont\bfseries\@BMSTU\par}%
	\egroup
	\vskip3mm\hrule height.7mm\vskip2pt\hrule}

\def\@subscr@line#1#2#3{%
	\noindent\hbox to \@stampleftwidth{#1\space#2\hfil}%
	\ulbox\@subspl@len{}\space
	\hbox to\@FIOpl@len{\itshape#3\hfil}\par\nobreak
	\hrule height0pt\nobreak\vskip1mm\noindent\hbox to \@stampleftwidth{%
		\ifempty{#1}\hphantom{#1}\space
		\hbox to\@grpl@len{\@underwr@font\hfil(группа)\hfil}\fi}%
	\hbox to\@subspl@len{\@underwr@font\hfil(подпись, дата)\hfil}\par}
	
\def\@subscr@line@forpract#1#2{%
		\noindent #1 \hbox to 0pt{\ \hspace{0.3\linewidth}#2\hss}\ulfill\par}

\def\@group@place{\underline{\hbox to\@grpl@len{\@ifundefined{@group}{}{\ \@group}\hfil}}}

\def\@make@pract@jobspec{
	{\centering\@title@shapka{}}%
	\vskip20mm
	\bgroup
	\centering
	{\fontsize{14pt}{14}\selectfont\bfseries{ЗАДАНИЕ}\par на прохождение \@jobsp@type@rod\par}%
	\egroup
	\vskip5\jsp
	\bgroup
	\parindent=0pt
	{\fontsize{12pt}{12}\selectfont
	На предприятии \ulfill\\
	\ulline\\
	\vspace{12pt}
	Студент \hbox to 0pt{\kern9em\@authorfull\space\@group\hss}\ulfill\par
	\hrule height0pt\vskip1mm\hbox to \hsize{\@underwr@font\hfil(Фамилия, Имя, Отчество, Индекс Группы)\hfil}\par
	\vskip5\jsp
	Во время прохождения \@jobsp@type@rod\space студент должен:\hfill{\space}\par
	\begin{enumerate}
		\item 
		\item 
		\item 
	\end{enumerate} 
	\vspace{20mm}
	Дата выдачи задания \al\,\ulbox{1.75em}{}\,\ar\kern0.2em\ulbox{6em}{}\space 20\ulbox{1.5em}{}\,г.\hfill{\space}\par
	\egroup
	\vspace{20mm}
	\bgroup
	\raggedright@
	\fontsize{12pt}{12}\selectfont\@subscr@line{Студент}{}{\@author}\par
	\vspace{21pt}
	\fontsize{12pt}{12}\selectfont\@subscr@line{\@chief@type}{}{\@ifundefined{@chief}{\ulbox{5em}{}}\@chief}\par
	\nobreak}
	\egroup
	\vfil
	\bgroup
	\if@VKR\else
	\vspace*{-15mm}\pagebreak\fi
	\egroup
}

\def\@make@jobspec{%
	\vspace*{-5mm}
	{\centering\@title@shapka{}}%
	\vskip5mm
	\hbox to \hsize{\hfil\@approval}%
	\vskip5\jsp
	\bgroup
	\centering
	{\fontsize{14pt}{14}\selectfont\bfseries{ЗАДАНИЕ}\par на выполнение\if@VKR\\\else\space\fi\@jobsp@type@rod\par}%
	\ifx\@zadan@title\relax\else\vskip1mm\@zadan@title\fi
	\egroup
	\vskip4\jsp
	\bgroup
	\parindent=0pt
	\fontsize{12pt}{12}\selectfont
	Студент \hbox to 0pt{\kern9em\@authorfull\space\@group\hss}\ulfill\par
	\hrule height0pt\vskip1mm\hbox to \hsize{\@underwr@font\hfil(Фамилия, Имя, Отчество, Индекс Группы)\hfil}\par
	\if@VKR\vskip3\jsp\fi
	\@zadan@theme
	\if@VKR
	\vskip2\jsp
	\else
	\vskip1\jsp
	Направленность \@jobsp@type@shrt\space\hbox to 0pt{\ \@trend\hss}\ulfill\par
	\hrule height0pt
	\hbox to \hsize{\@underwr@font\hphantom{Направленность КП}\hfil
		(учебная, исследовательская, практическая, производственная и др.)\hfil}\par
	\fi
	\vskip1\jsp
	Источник тематики \hbox to 0pt{\ \@themesource\hss}\ulfill\par
	\@make@zadanie
	\vskip3\jsp
	{\itshape\bfseries Оформление \@jobsp@type@rod:}\\[1mm]
	Расчетно-пояснительная записка на \ulbox{2em}{} листах формата A4.\par
	\vskip1\jsp
	Перечень графического (иллюстративного) материала\space\hrulefill\\
	\hbox{}\hrulefill\\\hbox{}\hrulefill\par
	\vskip2\jsp
	Дата выдачи задания \al\,\ulbox{1.75em}{}\,\ar\kern0.2em\ulbox{6em}{}\space 20\ulbox{1.5em}{}\,г.\par
	\if@VKR
	\vskip5\jsp
	В соответствии с учебным планом выпускную квалификационную работу выполнить в полном объеме
	в срок до \al\,\UlBox{1.7em}{}\,\ar\kern0.2em \UlBox{6em}{}\space 20\ulbox{1.5em}{}\,г.\par
	\fi
	\egroup
	\vspace{20mm}
	\bgroup
	\fontsize{12pt}{12}\selectfont
	\raggedright@
	\@subscr@line{Студент}{}{\@author}\par
	\vskip2\jsp
	\@subscr@line{\@chief@type}{}{\@ifundefined{@chief}{\ulbox{5em}{}}\@chief}\par
	\nobreak
	\egroup
	\vfil
	\bgroup
	\if@VKR\else
	\vspace*{-15mm}\pagebreak\fi
	\egroup}

\def\kalplan{%
	\bgroup
	\headheight=0pt\headsep=0pt\thispagestyle{empty}
	\vspace*{-5mm}
	{\centering\@title@shapka{}}%
	\vskip5mm
	\hbox to \hsize{
		\vbox{\hsize=15em
			\def\hd##1{\noindent\hbox to 8em{\bf##1\hfil}}%
			\hd{ФАКУЛЬТЕТ} \UlBox{5em}{\ \@faculty@short}\par
			\vskip4mm
			\hd{КАФЕДРА}   \UlBox{5em}{\ \@chairno}\par
			\vskip4mm
			\hd{ГРУППА}    \UlBox{5em}{\ \@group}\par
			\vskip1mm}
		\hfill
		\@approval}
	\vskip5mm
	\bgroup
	\centering
	{\bfseries{КАЛЕНДАРНЫЙ{ }ПЛАН}\\выполнения \@jobsp@type@rod}\par
	\vskip2mm
	Студент: \UlBox{18em}{\ \ \@authorfull}\par
	\vskip2mm
	Тема квалификационной работы:\\
	{\bfseries \@title}\par
	\vskip5mm
	\@make@tabdat
	\egroup
	\vfil
	\bgroup
	\fontsize{11pt}{11}\selectfont
	\hbox to \hsize{%
		{\itshape Студент} \ulbox{11em}{}\hfil
		{\itshape Руководитель работы} \ulbox{11em}{}}%
	\hbox to \hsize{%
		\def\hlp{\hbox to 11em{\@underwr@font\hfil (подпись, дата)\hfil}}%
		\hphantom{\itshape Студент} \hlp\hfil
		\hphantom{\itshape Руководитель работы} \hlp}%
	\egroup
	\vspace*{-5mm}
	\pagebreak
	\egroup}

\def\@make@tabdat{%
	\bgroup
	\fontsize{11pt}{11}\selectfont\parindent=0pt
	\tabcolsep=1mm
	\def\hdf{\fontsize{9pt}{9}\selectfont\bfseries}%
	\def\mc##1{\multicolumn{2}{c|}{##1}}%
	\def\hpb##1##2{\parbox{##1em}{\usup{2.4}0\centering\hdf\baselineskip2.4ex##2\luft\usup0{0.9}}}%
	\def\b##1##2{\hbox to ##1em{\hdf\hss##2\hss}}%
	\def\rt{\rightskip0pt plus15pt}%
	\def\lpb##1##2{\parbox{##1em}{\rt\usup{2.4}0\baselineskip2.4ex##2\usup0{0.8}\luft}}%
	\def\cpb##1##2{\parbox{##1em}{\centering\baselineskip2.4ex##2\luft}}%
	\newcommand\@pl@dat{\cpb{5.0}{\usup{1.5}0\ulbox{4em}{}\\
			\fontsize{3pt}{3}\selectfont \emph{Планируемая дата}\usup0{0.7}}}%
	\def\agent##1{\cpb{5}{\fontsize{9}{11}\selectfont##1}}%
	\def\ruk{\agent{\noindent\kern-0.32emРуководитель\kern-0.2em\\ВКР}\kern-0.1em}%
	\noindent\kern-0.22em
	\begin{tabular}{|c|l|c|c|c|c|}
		\hline
		\kern-0.1em\hpb{1.7}{№ п/п\vj{-8}}\kern-0.1em&
		\hpb{16}{Наименование этапов выпускной квалификационной работы\vj{-9}}&
		\mc{\hpb{9.5}{Сроки выполнения этапов}}&
		\mc{\hpb{11.5}{Отметка о выполнении}}\\
		\cline{3-6}
		&& \b{4.5}{план}& \b{4.5}{факт}&  \hdf\kern0.1em должность\kern0.1em&
		\hdf ФИО, подпись\usup{2.2}{0.8}\\
		\hline
		1.& \lpb{16}{Задание на выполнение работы. Формулирование проблемы, цели и задач работы}&
		\@pl@dat & & \ruk&\\[3pt]
		\hline
		&&&&&\\[-9pt]
		2.& Часть 1. \hrulefill& \@pl@dat && \ruk&\\[6pt]
		\hline
		3.& \lpb{16.2}{Утверждение окончательных формулировок решаемой проблемы, цели работы и перечня задач}& \@pl@dat && \agent{Заведующий кафедрой}\kern-0.2em&\\[6pt]
		\hline
		&&&&&\\[-9pt]
		4.& Часть 2. \hrulefill& \@pl@dat && \ruk&\\[6pt]
		\hline
		&&&&&\\[-9pt]
		5.& Часть 3. \hrulefill& \@pl@dat && \ruk&\\[6pt]
		\hline
		&&&&&\\[-9pt]
		6.& 1-я редакция работы& \@pl@dat && \ruk&\\[6pt]
		\hline
		&&&&&\\[-9pt]
		7.& Подготовка доклада и презентации& \@pl@dat && &\\[6pt]
		\hline
		&&&&&\\[-9pt]
		8.& Заключение руководителя& \@pl@dat&& \ruk&\\[6pt]
		\hline
		9.& \lpb{16}{Допуск работы к защите на ГЭК(нормоконтроль)}& \@pl@dat&& \agent{Нормоконт\-ролер}&\\[6pt]
		\hline
		&&&&&\\[-9pt]
		10.& Внешняя рецензия& \@pl@dat&& &\\[6pt]
		\hline
		&&&&&\\[-9pt]
		11.& Защита работы на ГЭК& \@pl@dat&& &\\[6pt]
		\hline
	\end{tabular}\kern-0.22em\par
	\egroup}

\def\@approval{%
	\vbox{\hsize=65mm\centering
		\fontsize{12pt}{12pt}\selectfont
		УТВЕРЖДАЮ\par
		\vskip1mm Заведующий кафедрой \ulbox{4em}{\@ifundefined{@chairno}{}{\ \@chairno}\hfil}\par
		\vskip3mm\indent\ulbox{6em}{}\space\hbox to 7em{\ifx\@chairhead\@empty\ \ulfill\else\@chairhead\fi}\par
		\vskip2mm\al\,\ulbox{2em}{}\,\ar\space\ulbox{6em}{}\space 20\ulbox{1.7em}{}\kern0.2em г.\par
}}


\def\gen@zadanie{\vskip1mm
	\bgroup
	\def\pl##1{##1\% к \ulbox{1.2em}{} нед.}%
	График выполнения работы:  \pl{25}, \pl{50}, \pl{75}, \pl{100}\par
	\egroup
	\vskip3mm
	{\itshape\bfseries Задание} \ulfill\\
	\ulline\\\ulline\\\ulline\\\ulline\par}

\def\@VKR@zadanie{\vskip4\jsp
	Тема выпускной квалификационной работы утверждена распоряжением
	по факультету \UlBox{12.5em}{\ \@faculty}\space \No\space\UlBox{3em}{}\space
	от \al\,\UlBox{1.7em}{}\,\ar\kern0.2em\UlBox{5em}{}\space 20\UlBox{1.5em}{}\,г.\par
	\vskip4\jsp
	{\itshape\bfseries Часть 1. \ulfill}\par
	\ulline\\\ulline\\\ulline\\\ulline\\\ulline\\\ulline\\\ulline\\\ulline\par
	\penalty-100
	\vskip2\jsp\vspace{2mm}
	{\itshape\bfseries Часть 2. \ulfill}\par
	\ulline\\\ulline\\\ulline\\\ulline\\\ulline\\\ulline\\\ulline\\\ulline\par
	\vskip2\jsp\vspace{2mm}
	{\itshape\bfseries Часть 3. \ulfill}\par
	\ulline\\\ulline\\\ulline\\\ulline\\\ulline\\\ulline\\\ulline\\\ulline\par
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%    Разные команды
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5

\newcommand\initcounter[1]{\stepcounter{#1}\addtocounter{#1}{-1}}
\let\al\guillemotleft\let\lk\al
\let\ar\guillemotright\let\rk\ar
\newcommand\brop[1]{#1\discretionary{}{\hbox{$#1$}}{}}
\let\ges\geqslant
\let\les\leqslant
\let\emptyset\varnothing
\renewcommand{\@makefntext}[1]{\parindent=1em\noindent \hbox to 1.8em{\hss\@makefnmark} \, #1}
%%Полужирный наклонный шрифт в формулах

\def\nb-{\nobreak\hskip0pt\hbox{-}\nobreak\hskip0pt}  %  неразрывный дефис
\def\nf-{\nobreak\hskip0pt\discretionary{-}{}{-}\nobreak\hskip0pt}   % дефис с сохранением точек переноса
\def\msps#1{\thinmuskip=#1\thinmuskip\medmuskip=#1\medmuskip\thickmuskip=#1\thickmuskip}
\def\mspsh#1#2#3{%
	\thickmuskip=#1\thickmuskip plus #2\thickmuskip minus #3\thickmuskip
	\medmuskip=#1\medmuskip plus #2\medmuskip minus #3\medmuskip
	\thinmuskip=#1\thinmuskip plus #2\thinmuskip minus #3\thinmuskip}
\def\@change@itemlists{%
	\let\@tempa\@listi\edef\@listi{\@tempa\@userpar}%
	\let\@listI\@listi
	\let\@tempa\@listii\edef\@listii{\@tempa\@userpar}%
	\let\@tempa\@listiii\edef\@listiii{\@tempa\@userpar}%
	\let\@tempa\@openbib@code\edef\@openbib@code{\@tempa\@userpar}%
	\let\@change@itemlists\relax}
\def\userpar#1{\@change@itemlists
	\def\@userpar{#1\global\let\@userpar\relax}\ignorespaces}
\let\@userpar\relax

\def\bi{\ifmmode\let\@next\boldsymbol
	\else\def\@next{\bfseries\itshape\mathversion{bold}}\fi\@next}
\newcommand\be[1]{\mbox{\mathversion{bold}${#1}$}}
\def\luft{\nobreak\hskip0pt}
\newcommand\usup[2]{\vrule height#1ex depth#2ex width0em}
\newcommand\usupw[2]{\vrule height#1ex depth#2ex width0.3pt}
\def\vj#1{\vadjust{\vskip#1pt}}
%\newcount\@oldcatcode
%\def\looser{\@oldcatcode=\the\catcode` \catcode` =13\relax\@looser}
%\def\@looser#1#2{\def\loos@space{\kern #1em}%
%	\def\loos@text ##1{##1\loos@space\noexpand\loos@text}%
%	\loos@text #2{\kern-#1em\let\loos@text=\relax
%		\catcode` =\the\@oldcatcode}\relax}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%  Дополнительный список (отрабатывается перед командой \begin{document})
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%\let\stprj@save@document\document
%\let\@startbegindocumenthook\@empty
%\def\document{\endgroup\@startbegindocumenthook\begingroup\stprj@save@document}
%\def\AtStartofBeginDocument{\g@addto@macro\@startbegindocumenthook}
\def\BlackColorLinks{\def\@hyper@colorlinks{false}}
\def\@hyper@colorlinks{true}

%\AtStartofBeginDocument{%
	%	\ifdefined\href
	%	\hypersetup{unicode=true, colorlinks=\@hyper@colorlinks, pdfborder = 0 0 0}
	%	\fi}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%   Работа с рисунками
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\long\def\@makecaption#1#2{%
	\def\@tempa{#2}\def\@tempb{\ignorespaces}%
	\ifx\@tempa\@tempb
	\def\@tempb{{\captionnofont{#1}}}%
	\else
	\def\@tempb{{\captionnofont{#1.}\space}}%
	\fi
	\sbox\@tempboxa{\captionfont\@tempb#2}%
	\ifdim \wd\@tempboxa >\hsize
	{\captionfont\@tempb#2\par}%
	\else
	\global \@minipagefalse
	\hb@xt@\hsize{\hfil\box\@tempboxa\hfil}%
	\fi}
%  Для вставки рисунка, не занимающего места
\def\dfb#1{\ifvmode \let\@tempa=\relax \else \let\@tempa=\vadjust\fi
	\@tempa{\vbox to 0pt{#1\vss}}}



\endinput